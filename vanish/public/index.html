<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Vanish Gomoku</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="landing-page">
    <div class="brand">
      <div class="logo">V</div>
      <div>
        <div class="title">Vanish Gomoku</div>
        <div class="subtitle">Connect 5... that you can't see</div>
      </div>
    </div>
    <h2 id="welcome-text">Logging in...</h2>
    <button id="retry-auth-btn" class="btn ghost hidden" style="margin: -10px auto 20px auto; padding: 5px 15px; font-size: 14px;" onclick="initializeUser()">Retry Connection</button>

    <div id="main-menu" class="menu-container">
    <button class="btn" onclick="selectMode('local_pvp')">Local PvP Game</button>
    <button class="btn" onclick="selectMode('local_ai')">Local AI Game</button>
    
    <button id="btn-online-private" class="btn" onclick="selectMode('online_private')">Online Private Room</button>
    <button id="btn-online-ladder" class="btn highlight-btn" onclick="selectMode('online_ladder')">Online Ladder</button>
    
    <div style="display: flex; gap: 10px; width: 100%;">
        <button class="btn ghost" style="flex: 1;" onclick="openInfoOverlay()">Profile</button>
        <button class="btn ghost" style="flex: 1;" onclick="openRulesOverlay()">How to Play</button>
    </div>
    <link rel="preload" href="board.jpeg" as="image">
</div>

    <div id="sub-menu" class="menu-container hidden">
        <h3 id="mode-title">Settings</h3>
        
        <div class="option-group" id="ai-level-group" style="display: none;">
            <label>AI Level:</label>
            <select id="ai-level-select">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
                <option value="expert">Expert</option>
            </select>
        </div>

        <div class="option-group">
            <label>Board Size:</label>
            <select id="board-size-select">
                <option value="3">3x3</option>
                <option value="9">9x9</option>
                <option value="15" selected>15x15</option>
            </select>
        </div>

        <div class="option-group">
            <label>Rules:</label>
            <select id="rule-set-select">
                <option value="nolimit">Standard</option>
                <option value="renju">Renju</option>
                <option value="swap2">Swap2</option>
            </select>
        </div>

        <div class="option-group">
            <label>Vanish:</label>
            <select id="vanish-timer-select">
                <option value="3000">3 Seconds</option>
                <option value="10000" selected>10 Seconds</option>
                <option value="3600000">Off</option>
            </select>
        </div>

        <div style="display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 10px;">
            <div id="queue-status" style="font-size: 13px; color: #ffcf40; text-align: center; display: none;">
                Checking queue...
            </div>
            <button id="start-btn" class="btn highlight-btn" onclick="confirmStart()">Start Match</button>
            <button id="join-btn" class="btn highlight-btn hidden" onclick="joinPrivateRoom()">Join a Room</button>
            <button class="btn ghost" onclick="backToMainMenu()">Back</button>
        </div>
    </div>
</div>

<div id="game-page" class="hidden">
    <div id="game-top-bar">
        <div class="top-bar-left">
            <button class="btn ghost small" onclick="quitGame()">Quit</button>
        </div>
        <div class="top-bar-center">
            <span class="title"></span>
        </div>
        <div class="top-bar-right" style="display: flex; gap: 8px;">
            <button id="btn-chat" class="btn ghost small hidden" onclick="openEmojiMenu()">üí¨</button>
            <button class="btn ghost small" onclick="offerDraw()">Draw</button>
            <button id="btn-surrender" class="btn ghost small" onclick="surrender()">üè≥Ô∏è Surrender</button>
        </div>
    </div>

    <div id="board-area">
        <div id="game-hud">
            <div id="p1-info" class="player-info">
                <div id="p1-pill" class="turn-piece p1 hidden"></div>
                <span id="p1-name">handsome guy</span>
                <div id="p1-emoji" class="emoji-bubble"></div>
            </div>

            <div id="timer-container">
                <span id="timerP1" class="timer">00:30</span>
            </div>

            <div id="p2-info" class="player-info player-info-right">
                <div id="p2-emoji" class="emoji-bubble"></div>
                <span id="p2-name">Guest</span>
                <div id="p2-pill" class="turn-piece p2 hidden"></div>
            </div>
        </div>

        <div id="board-container">
            <div id="board-wrap" class="board-wrap">
                <div id="board" class="board"></div>
                
                <div id="overlay" class="overlay hidden">
                  <div class="overlay-card">
                    <div id="overlayTitle" class="overlay-title">Message</div>
                    <div id="overlayBody" class="overlay-body" style="white-space: pre-wrap;">...</div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button id="overlayBtn" class="btn">New Game</button>
                        <button id="overlayBtnReplay" class="btn ghost hidden">Watch Replay</button>
                        <button id="overlayBtn2" class="btn ghost hidden">Main Menu</button>
                        <button id="minimize-overlay-btn" class="icon-btn hidden" onclick="minimizeOverlay()" title="Minimize to view board">‚ñº</button>
                        <button id="restore-overlay-btn" class="restore-btn hidden" onclick="restoreOverlay()">‚ñ≤ Show Menu</button>
                    </div>
                  </div>
                </div>
                
            </div> </div> </div> 
            <div id="bottom-controls" style="width: 100%; text-align: center; padding-bottom: 10px;">
                <button id="btn-place" onclick="confirmPlacement()" disabled>Confirm Move</button>
                <div id="mistakeMeter" class="meter"></div>
            </div>

            <div id="replay-controls" class="hidden" style="width: 100%; padding-bottom: 10px; display: flex; justify-content: center; gap: 10px; padding-top: 10px;">
                <button class="btn ghost" style="min-width: 80px;" onclick="prevReplayMove()">‚óÄ Prev</button>
                <button class="btn highlight-btn" style="min-width: 80px;" onclick="nextReplayMove()">Next ‚ñ∂</button>
                <button class="btn ghost" style="margin-left: 10px;" onclick="endReplay()">End</button>
            </div>
</div> 



<div id="info-overlay" class="modal-overlay hidden">
    <div class="modal-content info-card">
        <div class="info-tabs">
            <button class="tab-btn active" onclick="switchTab('stats')">Profile</button>
            <button class="tab-btn" onclick="switchTab('rankings')">Rankings</button>            
            <button class="tab-btn" onclick="switchTab('rules')">Rules</button>
        </div>

        <div id="tab-rankings" class="tab-content">
            <h3>World Rankings</h3>
            <ul id="leaderboardList" class="leaderboard-list">
                </ul>
        </div>

        <div id="tab-stats" class="tab-content hidden">
            <h3>My Profile</h3>
            <div class="stat-row">
              <span>Username:</span>
              <span style="display: flex; align-items: center; gap: 10px;">
                <strong id="stat-username">Guest</strong>
                <button id="btn-edit-name" class="btn small ghost" style="padding: 2px 8px; font-size: 0.8rem;">‚úèÔ∏è Edit</button>
              </span>
            </div>
            <div class="stat-row"><span>Standard ELO:</span> <span id="stat-elo">-</span></div>
            <div class="stat-row"><span>Wins:</span> <span id="stat-wins">0</span></div>
            <div class="stat-row"><span>Losses:</span> <span id="stat-losses">0</span></div>
        </div>

        <div id="tab-rules" class="tab-content hidden" style="text-align: left; padding: 10px;">
            <h4>Play Modes</h4>
            <p><strong>Standard:</strong> Connect 5 stones in a row (horizontally, vertically, or diagonally) to win.</p>
            <p><strong>Renju:</strong> Black (P1) has restricted moves (no double-threes, double-fours, or overlines) to balance the game.</p>
            <p><strong>Swap2:</strong> A tournament opening where P1 places 3 stones, and P2 chooses to stay, swap colors, or place 2 more and let P1 choose color.</p>
            <h4>Vanish</h4>
            <p>Stones disappear from sight after a set time! Remember where they are, because they are still there. Clicking on an occupied location results in a strike. 3 strikes = pentaly of skipping a turn!</p>
        </div>

        <button class="btn ghost" style="margin-top: 20px;" onclick="closeInfoOverlay()">Close</button>
    </div>

</div>

<div id="matchmaking-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2 id="matchmaking-text">Searching for opponent...</h2>
        <div id="matchmaking-spinner" class="spinner"></div>
        <div id="matchmaking-actions" class="hidden" style="flex-direction: column; gap: 10px; margin-top: 20px;">
            <button class="btn" onclick="playAIWhileWaiting()">Play AI While Waiting</button>
            <button class="btn ghost" onclick="cancelMatchmaking()">Cancel Search</button>
        </div>
        <button id="matchmaking-cancel-initial" class="btn ghost" style="margin-top: 20px;" onclick="cancelMatchmaking()">Cancel</button>
    </div>
</div>

<div id="match-found-modal" class="modal-overlay hidden" style="z-index: 2000;">
    <div class="modal-content">
        <h2 style="color: #ffcf40;">Opponent Found!</h2>
        <p>Accept match and quit AI game?</p>
        <button class="btn" style="margin-bottom: 10px;" onclick="acceptOnlineMatch()">Accept Match</button>
        <button class="btn ghost" onclick="declineOnlineMatch()">Decline</button>
    </div>
</div>

<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<script src="rules.js"></script>
<script src="main.js"></script>
</body>
</html>